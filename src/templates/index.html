<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© Ø§Ù„Ø°ÙƒÙŠ</title>
    <!-- Local CSS for Offline Support -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            position: relative;
            overflow: hidden;
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
            text-align: right;
        }

        .input-glass:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #4facfe;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.3);
        }

        .btn-glow {
            background: linear-gradient(90deg, #00c6ff 0%, #0072ff 100%);
            box-shadow: 0 4px 15px rgba(0, 114, 255, 0.4);
            transition: all 0.3s ease;
        }

        .btn-glow:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 114, 255, 0.6);
        }

        /* Status Animations */
        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(231, 76, 60, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }

        @keyframes pulse-green {
            0% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(46, 204, 113, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0);
            }
        }

        .status-badge {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .status-alert {
            background-color: #e74c3c;
            animation: pulse-red 2s infinite;
        }

        .status-ok {
            background-color: #2ecc71;
            animation: pulse-green 2s infinite;
        }

        .status-warning {
            background-color: #f39c12;
        }

        /* Result Layer - Fixed Overlay */
        .result-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            z-index: 20;
            display: none;
            /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 24px;
            text-align: center;
            border-radius: 24px;
            overflow-y: auto;
        }

        .result-layer.show {
            display: flex;
        }

        /* Utility class for hiding elements */
        .hidden {
            display: none !important;
        }

        .cost-card {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.4);
            border-radius: 16px;
            padding: 16px;
            margin-top: 12px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cost-item:last-child {
            border-bottom: none;
        }
    </style>
</head>

<body class="p-4">

    <div class="container max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">

        <!-- Right Column: Branding -->
        <div class="space-y-6 text-center lg:text-right order-last lg:order-first">
            <h1 class="text-5xl font-extrabold tracking-tight leading-tight">
                Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ† <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-cyan-300">Ø§Ù„Ø·Ø§Ù‚Ø©
                    Ø§Ù„Ø´Ù…Ø³ÙŠØ©</span>
            </h1>
            <p class="text-lg text-blue-100 font-light max-w-md mx-auto lg:mx-0">
                Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø£ØªØ±Ø¨Ø© ÙˆØ§Ù„ØºØ¨Ø§Ø± ÙˆØ§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª
                Ø§Ù„ÙØ¹Ù„ÙŠ.
            </p>
        </div>

        <!-- Left Column: Interface -->
        <div class="glass-card p-8 w-full max-w-md mx-auto order-first lg:order-last" style="min-height: 450px;">

            <!-- Form Layer -->
            <form id="predictForm" class="space-y-6">
                <div class="space-y-2">
                    <label class="text-sm font-bold text-blue-200">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</label>
                    <input type="datetime-local" id="datetime" class="w-full p-4 rounded-xl input-glass" required>
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-bold text-blue-200">Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© (kW)</label>
                    <div class="flex gap-2">
                        <input type="number" id="system_size" step="0.1" placeholder="Ù…Ø«Ù„Ø§Ù‹: 2 Ø£Ùˆ 3"
                            class="w-full p-4 rounded-xl input-glass font-mono" required>
                        <button type="button" onclick="showSystemCalculator()"
                            class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-xl text-white font-bold transition-colors"
                            title="Ø­Ø§Ø³Ø¨Ø© Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                        </button>
                    </div>
                    <p class="text-xs text-blue-300">Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ù„Ø­Ø³Ø§Ø¨Ù‡Ø§ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ø­ ÙˆÙ‚ÙˆØ© Ø§Ù„Ù„ÙˆØ­</p>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-sm font-bold text-blue-200">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ Ø§Ù„Ø´Ù…Ø³ÙŠ (kW/mÂ²)</label>
                        <input type="number" id="irradiation" step="0.0001" placeholder="0.85"
                            class="w-full p-4 rounded-xl input-glass font-mono" required>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-bold text-blue-200">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Â°C)</label>
                        <input type="number" id="temperature" step="0.1" placeholder="45.0"
                            class="w-full p-4 rounded-xl input-glass font-mono" required>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-bold text-blue-200">Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„ÙŠÙˆÙ… (kWh) <span
                            class="bg-white px-2 py-1 rounded text-xs mr-2" style="background: rgba(255,255,255,0.1)">Ù…Ù†
                            Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ù†ÙØ±ØªØ±</span></label>
                    <input type="number" id="actual_power" step="0.1" placeholder="Ù…Ø«Ù„Ø§Ù‹: 8 Ø£Ùˆ 10 Ø£Ùˆ 15"
                        class="w-full p-4 rounded-xl input-glass font-mono">
                    <p class="text-xs text-blue-300">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ù†ÙØ±ØªØ± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</p>
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-bold text-blue-200">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…Ù†Ø²Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ (kWh)</label>
                    <div class="flex gap-2">
                        <input type="number" id="daily_consumption" step="0.1" placeholder="Ù…Ø«Ù„Ø§Ù‹: 10 Ø£Ùˆ 15"
                            class="w-full p-4 rounded-xl input-glass font-mono">
                        <button type="button" onclick="showCalculator()"
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-xl text-white font-bold transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                    <p class="text-xs text-blue-300">Ù…ØªÙˆØ³Ø· Ù…Ø§ ÙŠØ­ØªØ§Ø¬Ù‡ Ù…Ù†Ø²Ù„Ùƒ ÙÙŠ 24 Ø³Ø§Ø¹Ø© Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø· Ø³Ø§Ø¹Ø©</p>
                </div>

                <button type="submit" class="w-full py-4 rounded-xl font-bold text-lg btn-glow text-white shadow-lg">
                    Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„ØªØ´Ø®ÙŠØµ
                </button>
            </form>

            <!-- Consumption Calculator Modal -->
            <div id="calcLayer" class="result-layer hidden" style="z-index: 30;">
                <h3 class="text-xl font-bold text-white mb-4">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…Ù†Ø²Ù„ÙŠ ğŸ </h3>

                <div class="w-full overflow-y-auto max-h-[60vh] text-right mb-4">
                    <table class="w-full text-sm text-blue-100">
                        <thead class="text-blue-200 border-b border-white/10">
                            <tr>
                                <th class="pb-2">Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                                <th class="pb-2 w-16">Ø§Ù„Ø¹Ø¯Ø¯</th>
                                <th class="pb-2 w-20">ÙˆØ§Øª</th>
                                <th class="pb-2 w-16">Ø³Ø§Ø¹Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="applianceList" class="divide-y divide-white/5">
                            <!-- Items inserted by JS -->
                        </tbody>
                    </table>
                </div>

                <div class="bg-white/10 rounded-xl p-4 w-full mb-4">
                    <div class="flex justify-between items-center">
                        <span class="text-blue-200">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</span>
                        <span class="font-bold text-xl text-yellow-300" dir="ltr"><span id="calcTotal">0.0</span>
                            kWh</span>
                    </div>
                </div>

                <div class="flex gap-3 w-full">
                    <button type="button" onclick="applyCalculation()"
                        class="flex-1 py-3 bg-green-600 hover:bg-green-700 rounded-xl text-white font-bold">
                        Ø§Ø¹ØªÙ…Ø§Ø¯
                    </button>
                    <button type="button" onclick="document.getElementById('calcLayer').classList.add('hidden')"
                        class="px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl text-white">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>

            <!-- System Size Calculator Modal -->
            <div id="systemCalcLayer" class="result-layer hidden" style="z-index: 30;">
                <h3 class="text-xl font-bold text-white mb-4">Ø­Ø§Ø³Ø¨Ø© Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©</h3>

                <div class="w-full text-right mb-4 space-y-4">
                    <div class="space-y-2">
                        <label class="text-sm font-bold text-blue-200">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ø­</label>
                        <input type="number" id="panelCount" min="1" value="4" onchange="calcSystemSize()"
                            class="w-full p-4 rounded-xl input-glass font-mono text-center" placeholder="4">
                    </div>

                    <div class="space-y-2">
                        <label class="text-sm font-bold text-blue-200">Ù‚ÙˆØ© Ø§Ù„Ù„ÙˆØ­ Ø§Ù„ÙˆØ§Ø­Ø¯ (ÙˆØ§Øª)</label>
                        <select id="panelWattage" onchange="calcSystemSize()"
                            class="w-full p-4 rounded-xl input-glass font-mono text-white bg-transparent">
                            <option value="250" class="bg-gray-800">250 ÙˆØ§Øª</option>
                            <option value="300" class="bg-gray-800">300 ÙˆØ§Øª</option>
                            <option value="350" class="bg-gray-800">350 ÙˆØ§Øª</option>
                            <option value="400" class="bg-gray-800">400 ÙˆØ§Øª</option>
                            <option value="450" class="bg-gray-800">450 ÙˆØ§Øª</option>
                            <option value="500" class="bg-gray-800">500 ÙˆØ§Øª</option>
                            <option value="550" selected class="bg-gray-800">550 ÙˆØ§Øª (Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹)</option>
                            <option value="600" class="bg-gray-800">600 ÙˆØ§Øª</option>
                            <option value="650" class="bg-gray-800">650 ÙˆØ§Øª</option>
                            <option value="custom" class="bg-gray-800">Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø£Ø®Ø±Ù‰...</option>
                        </select>
                        <input type="number" id="customWattage" min="100" max="1000" value="550"
                            onchange="calcSystemSize()"
                            class="w-full p-4 rounded-xl input-glass font-mono text-center hidden"
                            placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨Ø§Ù„ÙˆØ§Øª">
                    </div>
                </div>

                <div class="bg-green-500/20 rounded-xl p-4 w-full mb-4 border border-green-500/50">
                    <div class="flex justify-between items-center">
                        <span class="text-green-200">Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©:</span>
                        <span class="font-bold text-2xl text-yellow-300" dir="ltr"><span
                                id="systemSizeResult">2.2</span> kW</span>
                    </div>
                    <p class="text-xs text-green-300 mt-2" id="systemCalcFormula">4 Ø£Ù„ÙˆØ§Ø­ Ã— 550 ÙˆØ§Øª = 2200 ÙˆØ§Øª = 2.2
                        ÙƒÙŠÙ„ÙˆÙˆØ§Øª</p>
                </div>

                <div class="flex gap-3 w-full">
                    <button type="button" onclick="applySystemSize()"
                        class="flex-1 py-3 bg-green-600 hover:bg-green-700 rounded-xl text-white font-bold">
                        Ø§Ø¹ØªÙ…Ø§Ø¯
                    </button>
                    <button type="button" onclick="document.getElementById('systemCalcLayer').classList.add('hidden')"
                        class="px-6 py-3 bg-white/10 hover:bg-white/20 rounded-xl text-white">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>

            <!-- Results Overlay (Hidden by default) -->
            <div id="resultLayer" class="result-layer hidden">
                <div id="statusIcon" class="w-16 h-16 rounded-full flex items-center justify-center mb-4 status-badge">
                    <svg id="iconSVG" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                    </svg>
                </div>

                <h3 class="text-sm font-bold text-blue-300 mb-1">Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„ÙŠÙˆÙ… (Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ)</h3>
                <p class="text-3xl font-mono font-bold text-white mb-2" dir="ltr"><span id="predPower">0.00</span> kWh
                </p>

                <!-- Power Loss Info -->
                <div id="lossInfo" class="bg-white rounded-xl p-3 w-full mb-3 hidden"
                    style="background: rgba(255,255,255,0.1)">
                    <div class="flex justify-between items-center">
                        <span class="text-blue-200 text-sm">ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø·Ø§Ù‚Ø© (Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØºØ¨Ø§Ø±):</span>
                        <span class="font-bold text-white" dir="ltr"><span id="powerLoss">0</span> kWh (<span
                                id="lossPercent">0</span>%)</span>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-3 w-full" style="background: rgba(255,255,255,0.1)">
                    <h4 class="text-xs uppercase text-blue-200 mb-2">Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø°ÙƒÙŠ</h4>
                    <p class="text-lg font-bold leading-relaxed text-yellow-300" id="recommendationText">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„...
                    </p>
                </div>

                <!-- Consumption Analysis & Deficit Cost (Prioritized) -->
                <div id="consumptionSection" class="cost-card w-full hidden mb-3">
                    <h4 class="text-sm font-bold text-white mb-3 border-b border-white/20 pb-2">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ
                        ÙˆØ§Ù„Ø¹Ø¬Ø²</h4>

                    <div class="cost-item">
                        <span class="text-blue-200">Ø§Ø­ØªÙŠØ§Ø¬Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</span>
                        <span class="font-bold text-white" dir="ltr"><span id="dailyNeeded">0</span> kWh</span>
                    </div>

                    <div class="cost-item">
                        <span class="text-blue-200">Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙØ¹Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…:</span>
                        <span class="font-bold text-green-300" dir="ltr"><span id="dailyProduced">0</span> kWh</span>
                    </div>

                    <!-- Deficit Alert -->
                    <div id="deficitAlert" class="mt-3 bg-red-500/20 p-3 rounded-lg border border-red-500/50 hidden">
                        <p class="text-sm text-red-200 mb-1">ğŸš¨ Ø¹Ø¬Ø² ÙÙŠ Ø§Ù„Ø·Ø§Ù‚Ø©!</p>
                        <p class="text-xs text-white mb-2">Ù„Ù† ØªÙƒÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ§Øª Ù„Ù„ÙŠÙˆÙ…. Ø³ØªØ­ØªØ§Ø¬ Ù„Ø´Ø±Ø§Ø¡ ÙƒÙ‡Ø±Ø¨Ø§Ø¡:</p>
                        <div class="flex justify-between items-center bg-red-900/40 p-2 rounded">
                            <span class="text-red-200 text-xs">ØªÙƒÙ„ÙØ© Ø§Ù„ØªØ¹ÙˆÙŠØ¶:</span>
                            <span class="font-bold text-white text-lg" dir="ltr"><span id="deficitCost">0</span>
                                Ø±ÙŠØ§Ù„</span>
                        </div>
                    </div>

                    <div id="surplusInfo" class="mt-3 bg-green-500/20 p-3 rounded-lg border border-green-500/50 hidden">
                        <p class="text-sm text-green-200">âœ… Ø¥Ù†ØªØ§Ø¬Ùƒ ÙŠØºØ·ÙŠ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙƒ ÙˆØ²ÙŠØ§Ø¯Ø©!</p>
                    </div>
                </div>

                <!-- Old Cost Section (Dust Loss) - Only shown if no consumption data -->
                <div id="dustCostSection" class="cost-card w-full hidden">
                    <h4 class="text-sm font-bold text-red-300 mb-3">ğŸ’¸ Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØºØ¨Ø§Ø±</h4>
                    <div class="cost-item">
                        <span class="text-blue-200">Ø®Ø³Ø§Ø±Ø© ÙƒÙ„ Ø³Ø§Ø¹Ø©:</span>
                        <span class="font-bold text-yellow-300" dir="ltr"><span id="costHourly">0</span> Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="cost-item">
                        <span class="text-blue-200">Ø®Ø³Ø§Ø±Ø© ÙŠÙˆÙ…ÙŠØ© (8 Ø³Ø§Ø¹Ø§Øª):</span>
                        <span class="font-bold text-orange-300" dir="ltr"><span id="costDaily">0</span> Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="cost-item">
                        <span class="text-blue-200">Ø®Ø³Ø§Ø±Ø© Ø´Ù‡Ø±ÙŠØ©:</span>
                        <span class="font-bold text-red-300 text-lg" dir="ltr"><span id="costMonthly">0</span>
                            Ø±ÙŠØ§Ù„</span>
                    </div>
                    <p class="text-xs text-blue-300 mt-3">* Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø¹Ø± 170 Ø±ÙŠØ§Ù„/ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø· Ø³Ø§Ø¹Ø©</p>
                </div>

                <button onclick="hideResults()" class="mt-4 px-6 py-2 rounded-xl font-bold btn-glow text-white">
                    Ø¥Ø¬Ø±Ø§Ø¡ ÙØ­Øµ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('datetime').value = new Date().toISOString().slice(0, 16);

        function hideResults() {
            const layer = document.getElementById('resultLayer');
            layer.classList.remove('show');
            // Small delay to allow transition if we added one, then hide
            setTimeout(() => {
                layer.classList.add('hidden');
            }, 10);
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        document.getElementById('predictForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.innerHTML = '<span class="animate-pulse">Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹ØµØ¨ÙŠØ©...</span>';

            // Capturing inputs
            const dailyConsumptionInput = document.getElementById('daily_consumption');
            const dailyConsumptionValue = dailyConsumptionInput ? dailyConsumptionInput.value : 0;

            console.log("Input Daily Consumption:", dailyConsumptionValue); // Debug

            const data = {
                datetime: document.getElementById('datetime').value,
                system_size: document.getElementById('system_size').value,
                irradiation: document.getElementById('irradiation').value,
                temperature: document.getElementById('temperature').value,
                actual_power: document.getElementById('actual_power').value,
                daily_consumption: dailyConsumptionValue
            };

            try {
                await new Promise(r => setTimeout(r, 800)); // UX delay

                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                console.log("Server Response:", result); // Debug

                // Show Results Layer
                const layer = document.getElementById('resultLayer');
                const statusIcon = document.getElementById('statusIcon');
                const iconSVG = document.getElementById('iconSVG');
                const lossInfo = document.getElementById('lossInfo');

                // Content Sections
                const consumptionSection = document.getElementById('consumptionSection');
                const dustCostSection = document.getElementById('dustCostSection');

                // 1. Basic Info
                document.getElementById('predPower').innerText = result.predicted_power;
                document.getElementById('recommendationText').innerText = result.recommendation;

                // 2. Power Loss Info (Top Card)
                if (result.actual_power !== null && result.power_loss > 0) {
                    document.getElementById('powerLoss').innerText = result.power_loss;
                    document.getElementById('lossPercent').innerText = result.loss_percent;
                    lossInfo.classList.remove('hidden');
                } else {
                    lossInfo.classList.add('hidden');
                }

                // 3. Financial / Consumption Logic (The Critical Part)
                // Default: Hide both first
                consumptionSection.classList.add('hidden');
                dustCostSection.classList.add('hidden');

                const hasConsumption = result.consumption_analysis && result.consumption_analysis.daily_needed > 0;

                if (hasConsumption) {
                    // SHOW CONSUMPTION SECTION
                    consumptionSection.classList.remove('hidden');

                    document.getElementById('dailyNeeded').innerText = result.consumption_analysis.daily_needed;
                    document.getElementById('dailyProduced').innerText = result.consumption_analysis.daily_produced;

                    if (result.consumption_analysis.deficit > 0) {
                        document.getElementById('deficitAlert').classList.remove('hidden');
                        document.getElementById('surplusInfo').classList.add('hidden');
                        document.getElementById('deficitCost').innerText = formatNumber(result.consumption_analysis.cost_to_cover);
                    } else {
                        document.getElementById('deficitAlert').classList.add('hidden');
                        document.getElementById('surplusInfo').classList.remove('hidden');
                    }
                }
                else if (result.actual_power !== null && result.power_loss > 0) {
                    // SHOW DUST COST SECTION (Fallback)
                    dustCostSection.classList.remove('hidden');

                    document.getElementById('costHourly').innerText = formatNumber(result.money_loss.hourly);
                    document.getElementById('costDaily').innerText = formatNumber(result.money_loss.daily);
                    document.getElementById('costMonthly').innerText = formatNumber(result.money_loss.monthly);
                }

                // 4. Status Icon Styling
                statusIcon.className = 'w-16 h-16 rounded-full flex items-center justify-center mb-4 status-badge';
                if (result.status === 'alert') {
                    statusIcon.classList.add('status-alert');
                    iconSVG.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />';
                } else if (result.status === 'warning') {
                    statusIcon.classList.add('status-warning');
                    iconSVG.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />';
                } else {
                    statusIcon.classList.add('status-ok');
                    iconSVG.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />';
                }

                // Show Layer
                layer.classList.remove('hidden');
                // Small delay to allow display flex to apply before adding opacity
                setTimeout(() => {
                    layer.classList.add('show');
                }, 10);

            } catch (err) {
                console.error(err);
                alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + err);
            } finally {
                btn.innerText = originalText;
            }
        });
        // Consumption Calculator Logic
        const appliances = [
            { name: "Ù…ÙƒÙŠÙ (1.5 Ø·Ù†)", watts: 1500, count: 0, hours: 5 },
            { name: "Ø«Ù„Ø§Ø¬Ø©", watts: 200, count: 1, hours: 24 },
            { name: "ØªÙ„ÙØ²ÙŠÙˆÙ†", watts: 100, count: 1, hours: 5 },
            { name: "Ù…Ø¶Ø®Ø© Ù…Ø§Ø¡", watts: 750, count: 0, hours: 0.5 },
            { name: "ØºØ³Ø§Ù„Ø© Ù…Ù„Ø§Ø¨Ø³", watts: 500, count: 0, hours: 1 },
            { name: "Ù…ÙƒÙˆØ§Ø©", watts: 1000, count: 0, hours: 0.5 },
            { name: "Ù…ÙƒÙ†Ø³Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©", watts: 1500, count: 0, hours: 0.5 },
            { name: "Ø®Ù„Ø§Ø·/Ø£Ø¯ÙˆØ§Øª Ù…Ø·Ø¨Ø®", watts: 300, count: 0, hours: 0.5 },
            { name: "Ù…ØµØ§Ø¨ÙŠØ­ (LED)", watts: 10, count: 5, hours: 6 },
            { name: "Ø´ÙˆØ§Ø­Ù† (Ø¬ÙˆØ§Ù„/Ù„Ø§Ø¨ØªÙˆØ¨)", watts: 20, count: 3, hours: 4 }
        ];

        function showCalculator() {
            const list = document.getElementById('applianceList');
            // Only populate if empty
            if (list.children.length === 0) {
                appliances.forEach((app, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="py-2">${app.name}</td>
                        <td class="py-2"><input type="number" min="0" value="${app.count}" onchange="calcTotal()" class="w-12 bg-transparent border-b border-white/30 text-center text-white focus:outline-none focus:border-blue-400"></td>
                        <td class="py-2"><input type="number" min="0" value="${app.watts}" onchange="calcTotal()" class="w-16 bg-transparent border-b border-white/30 text-center text-white focus:outline-none focus:border-blue-400"></td>
                        <td class="py-2"><input type="number" min="0" step="0.5" value="${app.hours}" onchange="calcTotal()" class="w-12 bg-transparent border-b border-white/30 text-center text-white focus:outline-none focus:border-blue-400"></td>
                    `;
                    list.appendChild(row);
                });
            }
            calcTotal();
            const layer = document.getElementById('calcLayer');
            layer.classList.remove('hidden');
            setTimeout(() => layer.classList.add('show'), 10);
        }

        function calcTotal() {
            const rows = document.getElementById('applianceList').querySelectorAll('tr');
            let totalWh = 0;
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                const count = parseFloat(inputs[0].value) || 0;
                const watts = parseFloat(inputs[1].value) || 0;
                const hours = parseFloat(inputs[2].value) || 0;
                totalWh += count * watts * hours;
            });
            const totalKwh = (totalWh / 1000).toFixed(2);
            document.getElementById('calcTotal').innerText = totalKwh;
        }

        function applyCalculation() {
            const total = document.getElementById('calcTotal').innerText;
            document.getElementById('daily_consumption').value = total;
            const layer = document.getElementById('calcLayer');
            layer.classList.remove('show');
            setTimeout(() => layer.classList.add('hidden'), 300);
        }

        // System Size Calculator Logic
        function showSystemCalculator() {
            calcSystemSize(); // Calculate initial value
            const layer = document.getElementById('systemCalcLayer');
            layer.classList.remove('hidden');
            setTimeout(() => layer.classList.add('show'), 10);
        }

        function calcSystemSize() {
            const panelCount = parseInt(document.getElementById('panelCount').value) || 0;
            const wattageSelect = document.getElementById('panelWattage');
            const customWattageInput = document.getElementById('customWattage');

            // Handle custom wattage option
            if (wattageSelect.value === 'custom') {
                customWattageInput.classList.remove('hidden');
            } else {
                customWattageInput.classList.add('hidden');
            }

            const wattage = wattageSelect.value === 'custom'
                ? parseInt(customWattageInput.value) || 550
                : parseInt(wattageSelect.value) || 550;

            const totalWatts = panelCount * wattage;
            const totalKw = (totalWatts / 1000).toFixed(2);

            document.getElementById('systemSizeResult').innerText = totalKw;
            document.getElementById('systemCalcFormula').innerText =
                `${panelCount} Ø£Ù„ÙˆØ§Ø­ Ã— ${wattage} ÙˆØ§Øª = ${totalWatts} ÙˆØ§Øª = ${totalKw} ÙƒÙŠÙ„ÙˆÙˆØ§Øª`;
        }

        function applySystemSize() {
            const total = document.getElementById('systemSizeResult').innerText;
            document.getElementById('system_size').value = total;
            const layer = document.getElementById('systemCalcLayer');
            layer.classList.remove('show');
            setTimeout(() => layer.classList.add('hidden'), 300);
        }

    </script>

</body>

</html>