<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ© Ø§Ù„Ø°ÙƒÙŠ</title>
    <!-- Local CSS for Offline Support -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fonts.css') }}">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            position: relative;
            overflow: hidden;
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
            text-align: right;
        }

        .input-glass:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #4facfe;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.3);
        }

        .btn-glow {
            background: linear-gradient(90deg, #00c6ff 0%, #0072ff 100%);
            box-shadow: 0 4px 15px rgba(0, 114, 255, 0.4);
            transition: all 0.3s ease;
        }

        .btn-glow:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 114, 255, 0.6);
        }

        /* Status Animations */
        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(231, 76, 60, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }

        @keyframes pulse-green {
            0% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(46, 204, 113, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0);
            }
        }

        .status-badge {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .status-alert {
            background-color: #e74c3c;
            animation: pulse-red 2s infinite;
        }

        .status-ok {
            background-color: #2ecc71;
            animation: pulse-green 2s infinite;
        }

        .status-warning {
            background-color: #f39c12;
        }

        /* Result Layer - Fixed Overlay */
        .result-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            z-index: 20;
            display: none;
            /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 24px;
            text-align: center;
            border-radius: 24px;
            overflow-y: auto;
        }

        .result-layer.show {
            display: flex;
        }

        /* Utility class for hiding elements */
        .hidden {
            display: none !important;
        }

        .cost-card {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.4);
            border-radius: 16px;
            padding: 16px;
            margin-top: 12px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cost-item:last-child {
            border-bottom: none;
        }
    </style>
</head>

<body class="p-4">

    <div class="container max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">

        <!-- Right Column: Branding -->
        <div class="space-y-6 text-center lg:text-right order-last lg:order-first">
            <h1 class="text-5xl font-extrabold tracking-tight leading-tight">
                Ù†Ø¸Ø§Ù… ØªØ­Ø³ÙŠÙ† <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-cyan-300">Ø§Ù„Ø·Ø§Ù‚Ø©
                    Ø§Ù„Ø´Ù…Ø³ÙŠØ©</span>
            </h1>
            <p class="text-lg text-blue-100 font-light max-w-md mx-auto lg:mx-0">
                Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø£ØªØ±Ø¨Ø© ÙˆØ§Ù„ØºØ¨Ø§Ø± ÙˆØ§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª
                Ø§Ù„ÙØ¹Ù„ÙŠ.
            </p>
        </div>

        <!-- Left Column: Interface -->
        <div class="glass-card p-8 w-full max-w-md mx-auto order-first lg:order-last" style="min-height: 450px;">

            <!-- Form Layer -->
            <form id="predictForm" class="space-y-6">
                <div class="space-y-2">
                    <label class="text-sm font-bold text-blue-200">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</label>
                    <input type="datetime-local" id="datetime" class="w-full p-4 rounded-xl input-glass" required>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-sm font-bold text-blue-200">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ Ø§Ù„Ø´Ù…Ø³ÙŠ (kW/mÂ²)</label>
                        <input type="number" id="irradiation" step="0.0001" placeholder="0.85"
                            class="w-full p-4 rounded-xl input-glass font-mono" required>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-bold text-blue-200">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Â°C)</label>
                        <input type="number" id="temperature" step="0.1" placeholder="45.0"
                            class="w-full p-4 rounded-xl input-glass font-mono" required>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-bold text-blue-200">Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© (kW) <span
                            class="bg-white px-2 py-1 rounded text-xs mr-2"
                            style="background: rgba(255,255,255,0.1)">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø³Ø§Ø³</span></label>
                    <input type="number" id="actual_power" step="0.01" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©..."
                        class="w-full p-4 rounded-xl input-glass font-mono">
                </div>

                <button type="submit" class="w-full py-4 rounded-xl font-bold text-lg btn-glow text-white shadow-lg">
                    Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„ØªØ´Ø®ÙŠØµ
                </button>
            </form>

            <!-- Results Overlay (Hidden by default) -->
            <div id="resultLayer" class="result-layer hidden">
                <div id="statusIcon" class="w-16 h-16 rounded-full flex items-center justify-center mb-4 status-badge">
                    <svg id="iconSVG" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                    </svg>
                </div>

                <h3 class="text-sm font-bold text-blue-300 mb-1">Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ)</h3>
                <p class="text-3xl font-mono font-bold text-white mb-2" dir="ltr"><span id="predPower">0.00</span> kW
                </p>

                <!-- Power Loss Info -->
                <div id="lossInfo" class="bg-white rounded-xl p-3 w-full mb-3 hidden"
                    style="background: rgba(255,255,255,0.1)">
                    <div class="flex justify-between items-center">
                        <span class="text-blue-200 text-sm">ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø·Ø§Ù‚Ø©:</span>
                        <span class="font-bold text-white" dir="ltr"><span id="powerLoss">0</span> kW (<span
                                id="lossPercent">0</span>%)</span>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-3 w-full" style="background: rgba(255,255,255,0.1)">
                    <h4 class="text-xs uppercase text-blue-200 mb-2">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                    <p class="text-lg font-bold leading-relaxed" id="recommendationText">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„...</p>
                </div>

                <!-- Cost Section -->
                <div id="costSection" class="cost-card w-full hidden">
                    <h4 class="text-sm font-bold text-red-300 mb-3">ğŸ’¸ Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ø§Ù„ØºØ¨Ø§Ø±</h4>
                    <div class="cost-item">
                        <span class="text-blue-200">Ø®Ø³Ø§Ø±Ø© ÙƒÙ„ Ø³Ø§Ø¹Ø©:</span>
                        <span class="font-bold text-yellow-300" dir="ltr"><span id="costHourly">0</span> Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="cost-item">
                        <span class="text-blue-200">Ø®Ø³Ø§Ø±Ø© ÙŠÙˆÙ…ÙŠØ© (8 Ø³Ø§Ø¹Ø§Øª):</span>
                        <span class="font-bold text-orange-300" dir="ltr"><span id="costDaily">0</span> Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="cost-item">
                        <span class="text-blue-200">Ø®Ø³Ø§Ø±Ø© Ø´Ù‡Ø±ÙŠØ©:</span>
                        <span class="font-bold text-red-300 text-lg" dir="ltr"><span id="costMonthly">0</span>
                            Ø±ÙŠØ§Ù„</span>
                    </div>
                    <p class="text-xs text-blue-300 mt-3">* Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø¹Ø± 170 Ø±ÙŠØ§Ù„/ÙƒÙŠÙ„Ùˆ ÙˆØ§Ø· Ø³Ø§Ø¹Ø©</p>
                </div>

                <button onclick="hideResults()" class="mt-4 px-6 py-2 rounded-xl font-bold btn-glow text-white">
                    Ø¥Ø¬Ø±Ø§Ø¡ ÙØ­Øµ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('datetime').value = new Date().toISOString().slice(0, 16);

        function hideResults() {
            const layer = document.getElementById('resultLayer');
            layer.classList.remove('show');
            // Small delay to allow transition if we added one, then hide
            setTimeout(() => {
                layer.classList.add('hidden');
            }, 10);
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        document.getElementById('predictForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.innerHTML = '<span class="animate-pulse">Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹ØµØ¨ÙŠØ©...</span>';

            const data = {
                datetime: document.getElementById('datetime').value,
                irradiation: document.getElementById('irradiation').value,
                temperature: document.getElementById('temperature').value,
                actual_power: document.getElementById('actual_power').value
            };

            try {
                await new Promise(r => setTimeout(r, 800)); // UX delay

                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                // Show Results
                const layer = document.getElementById('resultLayer');
                const statusIcon = document.getElementById('statusIcon');
                const iconSVG = document.getElementById('iconSVG');
                const lossInfo = document.getElementById('lossInfo');
                const costSection = document.getElementById('costSection');

                document.getElementById('predPower').innerText = result.predicted_power;
                document.getElementById('recommendationText').innerText = result.recommendation;

                // Show power loss and cost if actual power was provided
                if (result.actual_power !== null && result.power_loss > 0) {
                    document.getElementById('powerLoss').innerText = result.power_loss;
                    document.getElementById('lossPercent').innerText = result.loss_percent;
                    lossInfo.classList.remove('hidden');

                    // Show cost section
                    document.getElementById('costHourly').innerText = formatNumber(result.money_loss.hourly);
                    document.getElementById('costDaily').innerText = formatNumber(result.money_loss.daily);
                    document.getElementById('costMonthly').innerText = formatNumber(result.money_loss.monthly);
                    costSection.classList.remove('hidden');
                } else {
                    lossInfo.classList.add('hidden');
                    costSection.classList.add('hidden');
                }

                // Apply conditional styling
                statusIcon.className = 'w-16 h-16 rounded-full flex items-center justify-center mb-4 status-badge';

                if (result.status === 'alert') {
                    statusIcon.classList.add('status-alert');
                    iconSVG.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />';
                } else if (result.status === 'warning') {
                    statusIcon.classList.add('status-warning');
                    iconSVG.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />';
                } else {
                    statusIcon.classList.add('status-ok');
                    iconSVG.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />';
                }

                // Correct toggle logic
                layer.classList.remove('hidden');
                // Small delay to allow display flex to apply before adding opacity if we had transitions
                setTimeout(() => {
                    layer.classList.add('show');
                }, 10);

            } catch (err) {
                alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
            } finally {
                btn.innerText = originalText;
            }
        });
    </script>

</body>

</html>